# MySQL数据库配置说明

## 1. 安装MySQL

如果还没有安装MySQL，请先安装：

### Windows
1. 下载MySQL安装程序：https://dev.mysql.com/downloads/mysql/
2. 运行安装程序，选择"Developer Default"或"Server only"
3. 记住设置的root密码

### 使用MySQL安装包或XAMPP
- XAMPP包含MySQL，下载地址：https://www.apachefriends.org/

## 2. 创建数据库

登录MySQL后，创建数据库：

```sql
CREATE DATABASE myweb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

或者使用MySQL命令行：

```bash
mysql -u root -p
# 输入密码后执行：
CREATE DATABASE myweb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

## 3. 配置环境变量

### 方法1：创建.env文件（推荐）

在项目根目录创建 `.env` 文件：

```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=myweb
JWT_SECRET=your-secret-key-change-in-production
PORT=3000
```

### 方法2：直接修改代码

如果不想使用.env文件，可以直接修改 `database/db.js` 中的默认值：

```javascript
host: process.env.DB_HOST || 'localhost',
user: process.env.DB_USER || 'root',
password: process.env.DB_PASSWORD || '你的密码',
database: process.env.DB_NAME || 'myweb',
```

## 4. 安装依赖

```bash
npm install
```

## 5. 启动服务器

```bash
npm start
```

服务器启动时会自动：
- 检查数据库是否存在，不存在则创建
- 创建所需的数据表
- 创建默认管理员账户（admin/admin123）

## 6. 验证安装

启动服务器后，如果看到以下信息说明成功：

```
数据库 myweb 已准备就绪
数据表创建完成
默认管理员账户已创建: admin / admin123
数据库初始化完成
服务器运行在 http://localhost:3000
```

## 常见问题

### 1. 连接被拒绝（ECONNREFUSED）

- 检查MySQL服务是否启动
- Windows: 在服务管理器中检查MySQL服务状态
- 确认DB_HOST和端口（默认3306）是否正确

### 2. 访问被拒绝（Access denied）

- 检查用户名和密码是否正确
- 确认MySQL用户有创建数据库的权限

### 3. 数据库不存在

- 确保MySQL服务正在运行
- 手动创建数据库（见步骤2）

### 4. 字符编码问题

- 确保数据库使用utf8mb4字符集
- 创建数据库时指定：`CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci`

## 使用XAMPP

如果使用XAMPP：

1. 启动XAMPP控制面板
2. 启动MySQL服务
3. 默认配置：
   - Host: localhost
   - User: root
   - Password: （通常为空）
   - Port: 3306

在 `.env` 文件中设置：
```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
DB_NAME=myweb
```


