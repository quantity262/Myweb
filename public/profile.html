<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 个人网站</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-container {
            min-height: 100vh;
            background: #f5f7fa;
            padding: 100px 2rem 2rem;
        }

        .profile-box {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .profile-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
            margin-bottom: 32px;
        }

        .profile-title {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .profile-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        .profile-section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .info-value {
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-button {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-button:hover {
            background: #1e40af;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }

        .form-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .message-success {
            background: #d1fae5;
            color: #065f46;
        }

        .message-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .message.show {
            display: block;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="profile-container">
        <div class="profile-box">
            <a href="/index.html" class="back-link">← 返回首页</a>
            
            <div class="profile-header">
                <h1 class="profile-title">个人中心</h1>
                <p class="profile-subtitle">管理你的账户信息</p>
            </div>

            <div class="message" id="message"></div>

            <!-- 账户信息 -->
            <div class="profile-section">
                <h2 class="section-title">账户信息</h2>
                <div class="info-item">
                    <span class="info-label">用户名</span>
                    <span class="info-value" id="userUsername">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">邮箱</span>
                    <span class="info-value" id="userEmail">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">角色</span>
                    <span class="info-value" id="userRole">-</span>
                </div>
            </div>

            <!-- 修改密码 -->
            <div class="profile-section">
                <h2 class="section-title">修改密码</h2>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label class="form-label" for="currentPassword">当前密码</label>
                        <input type="password" id="currentPassword" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="newPassword">新密码</label>
                        <input type="password" id="newPassword" class="form-input" required minlength="6">
                        <small style="color: var(--text-light); font-size: 12px; margin-top: 4px; display: block;">密码至少需要6个字符</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="confirmPassword">确认新密码</label>
                        <input type="password" id="confirmPassword" class="form-input" required minlength="6">
                    </div>
                    <button type="submit" class="form-button" id="submitBtn">修改密码</button>
                </form>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script>
        // 检查登录状态
        if (!requireAuth()) {
            // requireAuth会处理重定向
        }

        const user = getUser();
        document.getElementById('userUsername').textContent = user.username;
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userRole').textContent = user.role === 'admin' ? '管理员' : '普通用户';

        // 修改密码表单
        document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            const messageEl = document.getElementById('message');
            const submitBtn = document.getElementById('submitBtn');

            // 隐藏消息
            messageEl.classList.remove('show');

            // 验证
            if (newPassword !== confirmPassword) {
                messageEl.className = 'message message-error show';
                messageEl.textContent = '两次输入的新密码不一致';
                return;
            }

            if (newPassword.length < 6) {
                messageEl.className = 'message message-error show';
                messageEl.textContent = '新密码至少需要6个字符';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = '修改中...';

            try {
                await authAPI.changePassword(currentPassword, newPassword);
                messageEl.className = 'message message-success show';
                messageEl.textContent = '密码修改成功！';
                
                // 清空表单
                document.getElementById('changePasswordForm').reset();
            } catch (error) {
                messageEl.className = 'message message-error show';
                messageEl.textContent = error.message || '修改密码失败，请重试';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '修改密码';
            }
        });
    </script>
</body>
</html>


