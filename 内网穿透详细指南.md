# 内网穿透详细指南

内网穿透可以让你的本地网站通过公网地址访问，非常适合临时测试、演示或开发调试。

## 📋 目录

1. [什么是内网穿透](#什么是内网穿透)
2. [方案一：ngrok（最简单）](#方案一ngrok最简单)
3. [方案二：frp（自建服务器）](#方案二frp自建服务器)
4. [方案三：cpolar（国内推荐）](#方案三cpolar国内推荐)
5. [方案四：natapp（国内免费）](#方案四natapp国内免费)
6. [方案五：花生壳（老牌工具）](#方案五花生壳老牌工具)
7. [常见问题](#常见问题)

---

## 什么是内网穿透

内网穿透（NAT穿透）是一种技术，可以将内网（本地）的服务映射到公网，让外网用户能够访问你的本地服务。

**适用场景**：
- ✅ 临时演示网站给客户
- ✅ 开发调试时让同事访问
- ✅ 测试移动端访问
- ✅ 不想购买服务器的临时方案

**注意事项**：
- ⚠️ 免费版通常有流量限制
- ⚠️ 免费版地址会变化（每次启动可能不同）
- ⚠️ 不适合生产环境长期使用

---

## 方案一：ngrok（最简单）

### 优点
- ✅ 使用简单，无需配置
- ✅ 支持 HTTPS
- ✅ 有免费版
- ✅ 跨平台支持

### 缺点
- ❌ 免费版地址每次变化
- ❌ 免费版有连接数限制
- ❌ 国外服务，国内访问可能较慢

### 详细步骤

#### 1. 注册账号

访问：https://ngrok.com
- 点击 "Sign up" 注册账号（可以使用 GitHub 账号登录）
- 注册后登录

#### 2. 获取认证令牌

登录后，在 Dashboard 页面可以看到你的 Authtoken，类似：
```
2abc123def456ghi789jkl012mno345pq_6r7s8t9u0v1w2x3y4z5
```

#### 3. 下载 ngrok

访问：https://ngrok.com/download
- Windows: 下载 `ngrok-stable-windows-amd64.zip`
- Mac: 下载 `ngrok-stable-darwin-amd64.zip`
- Linux: 下载 `ngrok-stable-linux-amd64.zip`

解压到任意目录，如 `D:\ngrok\`

#### 4. 配置认证令牌

**Windows PowerShell**：
```powershell
cd D:\ngrok
.\ngrok.exe config add-authtoken 你的认证令牌
```

**Windows CMD**：
```cmd
cd D:\ngrok
ngrok.exe config add-authtoken 你的认证令牌
```

**Mac/Linux**：
```bash
cd ~/ngrok
./ngrok config add-authtoken 你的认证令牌
```

#### 5. 启动你的网站

确保你的网站已经在本地运行：
```bash
cd D:\MyWeb
npm start
```

网站应该在 `http://localhost:3000` 运行

#### 6. 启动 ngrok

**Windows PowerShell**：
```powershell
cd D:\ngrok
.\ngrok.exe http 3000
```

**Windows CMD**：
```cmd
cd D:\ngrok
ngrok.exe http 3000
```

**Mac/Linux**：
```bash
cd ~/ngrok
./ngrok http 3000
```

#### 7. 获取公网地址

启动后会显示类似信息：
```
Forwarding   https://abc123.ngrok.io -> http://localhost:3000
```

**公网地址**：`https://abc123.ngrok.io`

现在任何人都可以通过这个地址访问你的网站！

#### 8. 查看访问日志

访问 http://localhost:4040 可以查看所有请求的详细信息

#### 9. 使用固定域名（付费功能）

免费版每次启动地址都会变化。如果需要固定域名，需要：
1. 升级到付费版（$8/月起）
2. 在 Dashboard 配置固定域名

---

## 方案二：frp（自建服务器）

### 优点
- ✅ 完全免费
- ✅ 可以自定义域名
- ✅ 性能好，无流量限制
- ✅ 开源项目

### 缺点
- ❌ 需要一台有公网IP的服务器
- ❌ 配置相对复杂

### 详细步骤

#### 1. 准备服务器

需要一台有公网IP的服务器（VPS），如：
- 阿里云轻量应用服务器
- 腾讯云CVM
- 其他VPS

#### 2. 在服务器上安装 frp

```bash
# 下载 frp（替换为最新版本号）
wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz

# 解压
tar -xzf frp_0.52.3_linux_amd64.tar.gz
cd frp_0.52.3_linux_amd64

# 移动文件
sudo mv frps frps.ini /usr/local/bin/
```

#### 3. 配置服务器端（frps.ini）

```bash
sudo nano /usr/local/bin/frps.ini
```

内容：
```ini
[common]
bind_port = 7000
token = 你的随机密钥（建议使用长随机字符串）
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = 你的密码
```

#### 4. 启动服务器端

```bash
sudo frps -c /usr/local/bin/frps.ini
```

或使用 systemd 服务（推荐）：
```bash
sudo nano /etc/systemd/system/frps.service
```

内容：
```ini
[Unit]
Description=Frp Server
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/frps -c /usr/local/bin/frps.ini
Restart=always

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
sudo systemctl start frps
sudo systemctl enable frps
```

#### 5. 在本地下载 frp 客户端

访问：https://github.com/fatedier/frp/releases
下载对应系统的版本（Windows 下载 `frp_0.52.3_windows_amd64.zip`）

#### 6. 配置本地客户端（frpc.ini）

解压后编辑 `frpc.ini`：
```ini
[common]
server_addr = 你的服务器IP
server_port = 7000
token = 你的随机密钥（与服务器端相同）

[web]
type = http
local_ip = 127.0.0.1
local_port = 3000
custom_domains = 你的域名.com  # 如果有域名，或使用服务器IP
```

#### 7. 启动本地客户端

**Windows PowerShell**：
```powershell
.\frpc.exe -c frpc.ini
```

**Mac/Linux**：
```bash
./frpc -c frpc.ini
```

#### 8. 访问

- 如果配置了域名：`http://你的域名.com`
- 如果使用IP：需要配置 Nginx 反向代理

---

## 方案三：cpolar（国内推荐）

### 优点
- ✅ 国内服务，速度快
- ✅ 免费版支持固定域名
- ✅ 使用简单
- ✅ 有中文界面

### 缺点
- ❌ 免费版有流量限制（每月1GB）
- ❌ 免费版有连接数限制

### 详细步骤

#### 1. 注册账号

访问：https://www.cpolar.com
- 点击"注册"创建账号
- 可以使用邮箱或手机号注册

#### 2. 下载客户端

访问：https://www.cpolar.com/download
- Windows: 下载 Windows 版本
- Mac: 下载 macOS 版本
- Linux: 下载 Linux 版本

#### 3. 安装并登录

安装后打开 cpolar，使用注册的账号登录

#### 4. 创建隧道

1. 点击"创建隧道"
2. 配置信息：
   - **隧道名称**：myweb（任意名称）
   - **协议**：HTTP
   - **本地地址**：127.0.0.1:3000
   - **域名类型**：选择"免费"或"付费"（免费版有随机域名）
   - **地区**：选择离你最近的地区

3. 点击"创建"

#### 5. 启动隧道

在隧道列表中，点击"启动"按钮

#### 6. 获取公网地址

启动后会显示公网地址，如：
```
https://xxxx.cpolar.cn
```

#### 7. 访问网站

使用显示的公网地址访问你的网站

#### 8. 固定域名（付费功能）

如果需要固定域名：
1. 升级到付费版（¥6/月起）
2. 在创建隧道时选择"自定义域名"
3. 配置你的域名解析

---

## 方案四：natapp（国内免费）

### 优点
- ✅ 国内服务
- ✅ 免费版可用
- ✅ 使用简单

### 缺点
- ❌ 免费版地址每次变化
- ❌ 免费版有流量限制

### 详细步骤

#### 1. 注册账号

访问：https://natapp.cn
- 点击"注册"创建账号

#### 2. 购买免费隧道

1. 登录后，点击"购买隧道"
2. 选择"免费隧道"
3. 配置：
   - **协议**：Web
   - **本地端口**：3000
4. 点击"购买"

#### 3. 下载客户端

访问：https://natapp.cn/download
下载对应系统的版本

#### 4. 获取 authtoken

在"我的隧道"页面，可以看到你的 authtoken

#### 5. 启动隧道

**Windows**：
```cmd
natapp.exe -authtoken=你的authtoken
```

**Mac/Linux**：
```bash
chmod +x natapp
./natapp -authtoken=你的authtoken
```

#### 6. 获取公网地址

启动后会显示：
```
Tunnel Status Online
Forwarding http://xxxx.natapp1.cc -> 127.0.0.1:3000
```

使用 `http://xxxx.natapp1.cc` 访问你的网站

---

## 方案五：花生壳（老牌工具）

### 优点
- ✅ 老牌工具，稳定
- ✅ 有免费版
- ✅ 支持多种协议

### 缺点
- ❌ 免费版功能有限
- ❌ 免费版带宽较小

### 详细步骤

#### 1. 注册账号

访问：https://hsk.oray.com
注册账号

#### 2. 下载客户端

下载花生壳客户端并安装

#### 3. 登录客户端

使用注册的账号登录

#### 4. 添加映射

1. 点击"内网穿透"
2. 点击"添加映射"
3. 配置：
   - **应用名称**：myweb
   - **内网主机**：127.0.0.1
   - **内网端口**：3000
   - **外网端口**：自动分配（免费版）
   - **映射类型**：HTTP

4. 点击"保存"

#### 5. 启动映射

在映射列表中，点击"启动"

#### 6. 获取访问地址

会显示类似：`http://xxxx.gicp.net:端口号`

---

## 常见问题

### Q1: 内网穿透安全吗？

**A**: 
- 免费版通常只适合临时测试
- 不要在生产环境使用免费内网穿透
- 建议使用 HTTPS（付费版通常支持）
- 不要在穿透的网站上存储敏感信息

### Q2: 为什么访问很慢？

**A**: 
- 免费版通常有带宽限制
- 服务器位置可能较远
- 可以尝试选择离你更近的服务器节点

### Q3: 地址每次都会变化吗？

**A**: 
- 免费版：通常每次启动地址都会变化
- 付费版：可以配置固定域名

### Q4: 可以穿透多个端口吗？

**A**: 
- 可以，创建多个隧道/映射即可
- 每个端口需要单独配置

### Q5: MySQL 数据库可以穿透吗？

**A**: 
- 可以，但不推荐（安全风险）
- 建议只在开发环境使用
- 生产环境应该使用云数据库

### Q6: 如何停止内网穿透？

**A**: 
- 按 `Ctrl+C` 停止客户端
- 或在客户端界面点击"停止"

### Q7: 内网穿透会影响本地访问吗？

**A**: 
- 不会，本地访问不受影响
- 内网穿透只是添加了一个公网入口

### Q8: 推荐使用哪个工具？

**A**: 
- **临时测试**：ngrok 或 cpolar
- **国内用户**：cpolar 或 natapp（速度快）
- **需要固定域名**：cpolar 付费版或 frp
- **有服务器**：frp（完全免费且性能好）

---

## 快速对比表

| 工具 | 免费版 | 固定域名 | 国内速度 | 推荐度 |
|------|-------|---------|---------|--------|
| ngrok | ✅ | ❌ | ⭐⭐ | ⭐⭐⭐ |
| cpolar | ✅ | ✅（付费） | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| natapp | ✅ | ❌ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 花生壳 | ✅ | ❌ | ⭐⭐⭐ | ⭐⭐⭐ |
| frp | ✅ | ✅ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 推荐方案

### 场景一：临时演示（1-2小时）
👉 **推荐：ngrok**
- 最简单，无需注册即可使用（注册后更稳定）
- 5分钟即可完成配置

### 场景二：国内用户临时测试
👉 **推荐：cpolar**
- 国内服务，速度快
- 免费版可用，注册简单

### 场景三：需要固定域名
👉 **推荐：cpolar 付费版** 或 **frp**
- cpolar：简单，¥6/月
- frp：免费，但需要服务器

### 场景四：长期使用
👉 **推荐：购买云服务器**
- 内网穿透不适合长期使用
- 云服务器更稳定、更安全

---

## 注意事项

1. ⚠️ **不要在生产环境使用免费内网穿透**
2. ⚠️ **不要在穿透的网站上存储敏感数据**
3. ⚠️ **定期更换密码和密钥**
4. ⚠️ **注意流量限制，避免超出免费额度**
5. ⚠️ **使用完毕后及时关闭隧道**

---

## 下一步

完成内网穿透后，你可以：
1. 将公网地址分享给其他人
2. 在移动设备上测试网站
3. 让客户预览网站效果

如果需要长期使用，建议查看 [部署指南.md](./部署指南.md) 了解如何部署到云服务器。

